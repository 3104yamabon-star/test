
# 岩槻南部公民館 当月の空き状況 常時監視（改善のみ通知・黄色ハイライト・Discord）

このリポジトリは、`https://saitama.rsv.ws-scs.jp/web/` を起点に、
**「施設の空き状況 → 利用目的から → 屋内スポーツ → バドミントン → 岩槻南部公民館」**
へ遷移して当月の空き状況を監視し、**× が △ or ○、△ が ○** の **改善のみ**検知して
**黄色ハイライト付き画像**で **Discord** に通知します（投稿タイトルは **「岩槻0」**）。

## 事前準備

1. Discord で Webhook を作成  
   - チャンネル設定 → Integrations → Webhooks → Create → URL を控える

2. GitHub Secrets を設定  
   - `BASE_URL` : `https://saitama.rsv.ws-scs.jp/web/`
   - `DISCORD_WEBHOOK_URL` : 1で取得した URL

3. 初回だけ `config.json` を確認  
   - `click_sequence` は遷移ラベル。必要に応じて文言の微修正を行ってください（UI変更に備える）。
   - `status_chars` は判定対象記号。サイトが画像アイコンでも `alt` に記号があれば検知可能。

## 実行

- GitHub Actions が **5分おき**に `monitor.py` を起動します。
- 初回は当月の状態を基準として保存（通知なし）。
- 以降、**改善（×→△/○、△→○）**が起きたセルのみ、画像を黄色ハイライトして Discord に投稿します。  
  画像は **カレンダー要素のみ**のスクショなので視認性が高いです。

## 実装のポイント

- `.jsp` 直リンク禁止に対応：**毎回トップからクリック遷移**。
- 画像差分ではなく **DOM解析による記号判定**（安定・軽量）。
- **月が変わったら基準を初期化**して誤検知防止。
- 施設名や UI 文言が変わった場合は `config.json` の `click_sequence` を更新してください。

## 注意事項

- 5分スケジュールは GitHub の仕様上、多少前後することがあります。
- 監視対象サイトの負荷を避けるため、過度な並列実行は行いません。
- UI更新でラベルや構造が変わった場合は `click_sequence` と `calendar_root_hint` を調整してください。
